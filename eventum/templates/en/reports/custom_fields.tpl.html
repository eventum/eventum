{include file="header.tpl.html"}
<br />
<form action="{$smarty.server.PHP_SELF}" name="custom_fields_report" method="get">
<input type="hidden" name="cat" value="generate">
<table bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center" width="400">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td bgcolor="{$cell_color}" colspan="3" class="default_white">
            <b>Custom Fields Report</b>
          </td>
        </tr>
        <tr>
          <td width="30%" class="default" align="center">
            <b>Field to Graph</b>
          </td>
          <td width="30%" class="default" align="center">
            <b>Options to Graph</b>
          </td>
        </tr>
        <tr>
          <td align="center" valign="top">
            <select name="custom_field" class="default" onChange="setOptions(this.options[this.selectedIndex].value, true)">
                <option value=""></option>
                {html_options options=$custom_fields selected=$custom_field}
            </select>
          </td>
          <td align="center" valign="top">
            <select name="custom_options[]" size="8" multiple class="default">
            </select>
          </td>
        </tr>
        <tr>
          <td colspan="2" align="center">
            <input type="submit" name="cat" value="Generate" class="shortcut">
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</form>
<div class="default" align="center">Based on all support cases recorded in CSC since start, Oct 1, 2003 to present.</div><br />
<script language="JavaScript">
var options = new Array();
var option_to_fld_id = new Array();
{foreach from=$options key=fld_id item=option_list name=option_list}
    option_to_fld_id[{$smarty.foreach.option_list.iteration-1}] = {$fld_id};
    options[{$smarty.foreach.option_list.iteration-1}] = new Array();
    {foreach from=$option_list key=cfo_id item=cfo_value name=option}
        options[{$smarty.foreach.option_list.iteration-1}][{$smarty.foreach.option.iteration-1}] = new Option('{$cfo_value}', '{$cfo_id}');
    {/foreach}
{/foreach}

{literal}
var options_field = document.forms['custom_fields_report'].elements['custom_options[]'];
function setOptions(fld_id, auto_select)
{
    fld_id_index = '';
    for (i = 0; i < option_to_fld_id.length; i++) {
        if (option_to_fld_id[i] == fld_id) {
            fld_id_index = i;
        }
    }
    
    options_field.length = 0;
    if (options[fld_id_index]) {
        options_field.length = options[fld_id_index].length;
        for (i = 0; i < options[fld_id_index].length; i++) {
            options_field.options[i] = options[fld_id_index][i];
            options_field.options[i].selected = auto_select;
        }
    }
}
{/literal}

setOptions('{$custom_field}', false);
{if $custom_options|@count > 0}
    {foreach from=$custom_options key=option_index item=option}
        options_field.options[{$option_index}].selected = true;
    {/foreach}
{/if}
</script>

{if $custom_options|@count > 0}
<div align="center" class="default">
    <img src="custom_fields_graph.php?{$smarty.server.QUERY_STRING}"><br /><br />
    <img src="custom_fields_graph.php?{$smarty.server.QUERY_STRING}&type=pie"><br />
    Percentages may not add up to exactly 100% due to rounding.<br /><br />
</div>
{/if}


{include file="footer.tpl.html"}